@model List<Tienda.Models.CarritoItem>

@{
    ViewData["Title"] = "Carrito de Compras";
    var total = Model.Sum(i => i.Cantidad * i.PrecioUnitario);
}

@section Styles {
    <style>
        .carrito-container {
          max-width: 1200px;
    margin: 0 auto;
        }

        .carrito-item {
            background-color: #1e1e2f;
        border: 1px solid #333;
  border-radius: 12px;
 padding: 1.5rem;
            margin-bottom: 1rem;
display: flex;
      align-items: center;
   gap: 1.5rem;
   transition: all 0.3s ease;
        }

        .carrito-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 188, 212, 0.2);
        }

        .carrito-item-info {
            flex-grow: 1;
        }

        .carrito-item-title {
     color: #00bcd4;
         font-weight: 700;
       font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .carrito-item-precio {
      color: #f1f1f1;
      font-size: 1.2rem;
            font-weight: 600;
        }

        .cantidad-control {
       display: flex;
            align-items: center;
          gap: 0.5rem;
        }

        .cantidad-btn {
            background-color: #00bcd4;
        color: #fff;
   border: none;
     width: 32px;
    height: 32px;
  border-radius: 6px;
            display: flex;
            align-items: center;
      justify-content: center;
         cursor: pointer;
     transition: all 0.2s ease;
    }

        .cantidad-btn:hover {
            background-color: #00acc1;
transform: scale(1.1);
        }

        .cantidad-input {
            width: 60px;
            text-align: center;
            background-color: #2a2a3e;
         color: #f1f1f1;
            border: 1px solid #444;
            border-radius: 6px;
            padding: 0.4rem;
      }

        .carrito-resumen {
   background-color: #1e1e2f;
   border: 1px solid #333;
            border-radius: 12px;
  padding: 2rem;
       position: sticky;
       top: 20px;
        }

        .resumen-item {
     display: flex;
 justify-content: space-between;
     margin-bottom: 1rem;
         color: #f1f1f1;
 }

        .resumen-total {
     font-size: 1.5rem;
    font-weight: 800;
          color: #00bcd4;
            border-top: 2px solid #333;
     padding-top: 1rem;
            margin-top: 1rem;
        }

   .empty-cart {
            text-align: center;
   padding: 4rem 2rem;
     background-color: #1e1e2f;
     border-radius: 12px;
   border: 1px solid #333;
}

.empty-cart i {
            font-size: 5rem;
            color: #666;
       margin-bottom: 1rem;
        }
    </style>
}

<div class="carrito-container">
    <h2 class="text-light fw-bold mb-4">
        <i class="bi bi-cart3"></i> Mi Carrito
    </h2>

@if (!Model.Any())
    {
        <div class="empty-cart">
   <i class="bi bi-cart-x"></i>
  <h4 class="text-light mb-3">Tu carrito está vacío</h4>
     <p class="text-muted mb-4">Agrega productos para comenzar tu compra</p>
            <a asp-controller="Productoes" asp-action="Index" class="btn btn-aura">
      <i class="bi bi-box-seam"></i> Ver Productos
            </a>
    </div>
    }
    else
    {
        <div class="row">
            <div class="col-lg-8">
                @foreach (var item in Model)
    {
      <div class="carrito-item">
            <div class="carrito-item-info">
     <h5 class="carrito-item-title">@item.Nombre</h5>
  <p class="carrito-item-precio">$@item.PrecioUnitario.ToString("N2")</p>
  </div>

             <div class="cantidad-control">
          <button class="cantidad-btn" onclick="actualizarCantidad(@item.ProductoId, @(item.Cantidad - 1))">
  <i class="bi bi-dash"></i>
  </button>
        <input type="number" class="cantidad-input" value="@item.Cantidad" 
        onchange="actualizarCantidad(@item.ProductoId, this.value)" min="1" />
      <button class="cantidad-btn" onclick="actualizarCantidad(@item.ProductoId, @(item.Cantidad + 1))">
          <i class="bi bi-plus"></i>
           </button>
    </div>

     <div>
 <strong class="text-aura">$@((item.Cantidad * item.PrecioUnitario).ToString("N2"))</strong>
      </div>

          <button class="btn btn-sm btn-danger" onclick="eliminarProducto(@item.ProductoId, '@item.Nombre')">
 <i class="bi bi-trash"></i>
  </button>
    </div>
    }
      </div>

   <div class="col-lg-4">
        <div class="carrito-resumen">
  <h4 class="text-light mb-4">Resumen del Pedido</h4>
      
          <div class="resumen-item">
       <span>Subtotal:</span>
     <strong>$@total.ToString("N2")</strong>
           </div>
      
 <div class="resumen-item">
  <span>Productos:</span>
          <strong>@Model.Sum(i => i.Cantidad) items</strong>
    </div>

  <div class="resumen-item resumen-total">
       <span>Total:</span>
     <strong>$@total.ToString("N2")</strong>
         </div>

             <button class="btn btn-aura w-100 mb-3" onclick="procesarCompra()">
    <i class="bi bi-credit-card"></i> Procesar Compra
        </button>

       <button class="btn btn-outline-secondary w-100 mb-2" onclick="limpiarCarrito()">
        <i class="bi bi-trash"></i> Vaciar Carrito
 </button>

         <a asp-controller="Productoes" asp-action="Index" class="btn btn-outline-aura w-100">
          <i class="bi bi-arrow-left"></i> Seguir Comprando
          </a>
                </div>
         </div>
        </div>
    }
</div>

@section Scripts {
  <script>
        function actualizarCantidad(productoId, cantidad) {
            if (cantidad < 1) {
             if (confirm('¿Deseas eliminar este producto del carrito?')) {
          eliminarProducto(productoId, '');
         }
       return;
   }

      fetch('@Url.Action("ActualizarCantidad", "Carrito")', {
       method: 'POST',
    headers: {
           'Content-Type': 'application/json'
  },
      body: JSON.stringify({
               productoId: productoId,
  cantidad: parseInt(cantidad)
            })
          })
      .then(response => response.json())
    .then(data => {
     if (data.success) {
           location.reload();
        }
     });
        }

function eliminarProducto(productoId, nombreProducto) {
         if (!confirm(`¿Deseas eliminar ${nombreProducto || 'este producto'} del carrito?`)) {
         return;
            }

   fetch('@Url.Action("EliminarProducto", "Carrito")', {
         method: 'POST',
          headers: {
              'Content-Type': 'application/json'
    },
        body: JSON.stringify({ productoId: productoId })
         })
  .then(response => response.json())
    .then(data => {
           if (data.success) {
             location.reload();
 }
            });
        }

        function limpiarCarrito() {
 if (!confirm('¿Estás seguro de vaciar todo el carrito?')) {
          return;
            }

            fetch('@Url.Action("Limpiar", "Carrito")', {
             method: 'POST'
            })
       .then(response => response.json())
    .then(data => {
    if (data.success) {
    location.reload();
  }
});
        }

   function procesarCompra() {
            // Redirigir a checkout para seleccionar cliente
    window.location.href = '@Url.Action("Checkout", "Carrito")';
        }
    </script>
}
